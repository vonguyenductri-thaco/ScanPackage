<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Admin - Simple Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }
        
        .tab-button {
            flex: 1;
            padding: 15px;
            border: none;
            background: #f0f0f0;
            color: #666;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
        }
        
        .tab-button.active {
            background: #4CAF50;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .step {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .preview {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
            font-family: monospace;
            font-size: 12px;
        }
        
        input[type="file"] {
            margin: 10px 0;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            width: 100%;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background: #f0f0f0;
            font-weight: bold;
        }
        
        .user-form {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr auto;
            gap: 10px;
            align-items: end;
            background: #f0fff0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .user-form input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .user-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Firebase Admin Dashboard</h1>
        
        <!-- Tab Navigation -->
        <div class="tab-buttons">
            <button class="tab-button active" onclick="switchTab('products')">
                üì¶ Qu·∫£n l√Ω S·∫£n ph·∫©m
            </button>
            <button class="tab-button" onclick="switchTab('users')">
                üë• Qu·∫£n l√Ω Ng∆∞·ªùi l·∫≠p
            </button>
        </div>
        
        <!-- Products Tab -->
        <div id="products-tab" class="tab-content active">
            <div class="step">
                <h3>üìÅ Upload Excel S·∫£n ph·∫©m</h3>
                <p>Ch·ªçn file Excel ch·ª©a d·ªØ li·ªáu s·∫£n ph·∫©m v·ªõi c√°c c·ªôt: <strong>Customer, Product, Model</strong></p>
                <input type="file" id="productsFile" accept=".xlsx,.xls" onchange="handleProductsFile(this)">
                <div id="productsStatus"></div>
                <div id="productsPreview" class="preview" style="display: none;"></div>
                <button id="productsUploadBtn" onclick="uploadProducts()" disabled>
                    üöÄ Upload S·∫£n ph·∫©m l√™n Firebase
                </button>
            </div>
        </div>
        
        <!-- Users Tab -->
        <div id="users-tab" class="tab-content">
            <!-- Option Selection -->
            <div class="step">
                <h3>Ch·ªçn c√°ch nh·∫≠p d·ªØ li·ªáu ng∆∞·ªùi l·∫≠p</h3>
                <div style="display: flex; gap: 20px; margin: 20px 0;">
                    <button id="excelOptionBtn" onclick="selectUserOption('excel')" class="active">
                        üìÅ Upload File Excel
                    </button>
                    <button id="manualOptionBtn" onclick="selectUserOption('manual')">
                        ‚úèÔ∏è Nh·∫≠p tr·ª±c ti·∫øp
                    </button>
                </div>
            </div>
            
            <!-- Excel Option -->
            <div id="excelOption" class="step">
                <h3>üìÅ Upload Excel Ng∆∞·ªùi l·∫≠p</h3>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4>üì• T·∫£i file m·∫´u</h4>
                    <p>T·∫£i file Excel m·∫´u, ƒëi·ªÅn th√¥ng tin ng∆∞·ªùi l·∫≠p:</p>
                    <button onclick="downloadUserTemplate()">üì• T·∫£i file m·∫´u Excel</button>
                </div>
                <p>Ch·ªçn file Excel v·ªõi c√°c c·ªôt: <strong>MSNV, H·ªç V√† T√™n, Ch·ª©c v·ª•</strong></p>
                <input type="file" id="usersFile" accept=".xlsx,.xls" onchange="handleUsersFile(this)">
                <div id="usersStatus"></div>
                <div id="usersPreview" class="preview" style="display: none;"></div>
                <button id="usersUploadBtn" onclick="uploadUsers()" disabled>
                    üöÄ Upload Ng∆∞·ªùi l·∫≠p l√™n Firebase
                </button>
            </div>
            
            <!-- Manual Option -->
            <div id="manualOption" class="step" style="display: none;">
                <h3>‚úèÔ∏è Nh·∫≠p tr·ª±c ti·∫øp</h3>
                <div class="user-form">
                    <div>
                        <label>MSNV:</label>
                        <input type="text" id="newUserMsnv" placeholder="VD: NV001">
                    </div>
                    <div>
                        <label>H·ªç v√† T√™n:</label>
                        <input type="text" id="newUserName" placeholder="VD: Nguy·ªÖn VƒÉn A">
                    </div>
                    <div>
                        <label>Ch·ª©c v·ª•:</label>
                        <input type="text" id="newUserPosition" placeholder="VD: Nh√¢n vi√™n">
                    </div>
                    <div>
                        <button onclick="addUser()">‚ûï Th√™m</button>
                    </div>
                </div>
                
                <div id="manualUsersTable">
                    <table>
                        <thead>
                            <tr>
                                <th>MSNV</th>
                                <th>H·ªç v√† T√™n</th>
                                <th>Ch·ª©c v·ª•</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="manualUsersTableBody">
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 20px; color: #666; font-style: italic;">
                                    Ch∆∞a c√≥ ng∆∞·ªùi l·∫≠p n√†o. H√£y th√™m ng∆∞·ªùi l·∫≠p m·ªõi ·ªü tr√™n.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <button id="manualUploadBtn" onclick="uploadManualUsers()" disabled>
                    üöÄ Upload danh s√°ch l√™n Firebase
                </button>
                <div id="manualStatus"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase variables
        let firebaseApp = null;
        let db = null;
        let productsData = [];
        let usersData = [];
        let manualUsers = [];
        
        // Initialize Firebase
        window.addEventListener('load', function() {
            initFirebase();
        });
        
        function initFirebase() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyDLyaG5keHZcy8gjLSATTq1LObgBNS8z1U",
                    authDomain: "scanpackage-app.firebaseapp.com",
                    projectId: "scanpackage-app"
                };
                
                firebaseApp = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log('Firebase connected successfully');
            } catch (error) {
                console.error('Firebase connection error:', error);
            }
        }
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Activate selected button
            event.target.classList.add('active');
        }
        
        // User option selection
        function selectUserOption(option) {
            const excelBtn = document.getElementById('excelOptionBtn');
            const manualBtn = document.getElementById('manualOptionBtn');
            const excelDiv = document.getElementById('excelOption');
            const manualDiv = document.getElementById('manualOption');
            
            if (option === 'excel') {
                excelBtn.classList.add('active');
                manualBtn.classList.remove('active');
                excelDiv.style.display = 'block';
                manualDiv.style.display = 'none';
            } else {
                manualBtn.classList.add('active');
                excelBtn.classList.remove('active');
                excelDiv.style.display = 'none';
                manualDiv.style.display = 'block';
            }
        }
        
        // Download user template
        function downloadUserTemplate() {
            const sampleData = [
                ['MSNV', 'H·ªç V√† T√™n', 'Ch·ª©c v·ª•'],
                ['NV001', 'Nguy·ªÖn VƒÉn A', 'Nh√¢n vi√™n'],
                ['NV002', 'Tr·∫ßn Th·ªã B', 'Tr∆∞·ªüng ph√≤ng'],
                ['NV003', 'L√™ VƒÉn C', 'Ph√≥ ph√≤ng']
            ];
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(sampleData);
            
            ws['!cols'] = [
                { width: 15 },
                { width: 25 },
                { width: 20 }
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, 'Danh s√°ch ng∆∞·ªùi l·∫≠p');
            XLSX.writeFile(wb, 'Mau_Danh_Sach_Nguoi_Lap.xlsx');
        }
        
        // Handle products file
        function handleProductsFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            showStatus('productsStatus', 'üìñ ƒêang ƒë·ªçc file...', 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    parseProductsData(jsonData);
                } catch (error) {
                    showStatus('productsStatus', '‚ùå L·ªói ƒë·ªçc file: ' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // Parse products data
        function parseProductsData(rawData) {
            if (!rawData || rawData.length < 2) {
                showStatus('productsStatus', '‚ùå File kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá', 'error');
                return;
            }
            
            const headers = rawData[0].map(h => h?.toString().trim().toLowerCase());
            const customerIndex = headers.findIndex(h => h.includes('customer') || h.includes('kh√°ch h√†ng'));
            const productIndex = headers.findIndex(h => h.includes('product') || h.includes('s·∫£n ph·∫©m'));
            const modelIndex = headers.findIndex(h => h.includes('model'));
            
            if (customerIndex === -1 || productIndex === -1 || modelIndex === -1) {
                showStatus('productsStatus', '‚ùå Kh√¥ng t√¨m th·∫•y c·ªôt Customer, Product, ho·∫∑c Model', 'error');
                return;
            }
            
            productsData = [];
            let validRows = 0;
            
            for (let i = 1; i < rawData.length; i++) {
                const row = rawData[i];
                if (!row || row.length === 0) continue;
                
                const customer = row[customerIndex]?.toString().trim();
                const product = row[productIndex]?.toString().trim();
                const model = row[modelIndex]?.toString().trim();
                
                if (customer && product && model) {
                    productsData.push({
                        customer: customer,
                        product: product,
                        model: model,
                        updatedAt: new Date()
                    });
                    validRows++;
                }
            }
            
            if (validRows === 0) {
                showStatus('productsStatus', '‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá', 'error');
                return;
            }
            
            showStatus('productsStatus', `‚úÖ ƒê·ªçc th√†nh c√¥ng ${validRows} s·∫£n ph·∫©m`, 'success');
            displayProductsPreview();
            document.getElementById('productsUploadBtn').disabled = false;
        }
        
        // Display products preview
        function displayProductsPreview() {
            const preview = document.getElementById('productsPreview');
            let html = '<table><tr><th>Customer</th><th>Product</th><th>Model</th></tr>';
            
            const displayCount = Math.min(productsData.length, 10);
            for (let i = 0; i < displayCount; i++) {
                const item = productsData[i];
                html += `<tr><td>${item.customer}</td><td>${item.product}</td><td>${item.model}</td></tr>`;
            }
            
            if (productsData.length > 10) {
                html += `<tr><td colspan="3" style="text-align: center; font-style: italic;">... v√† ${productsData.length - 10} s·∫£n ph·∫©m kh√°c</td></tr>`;
            }
            
            html += '</table>';
            preview.innerHTML = html;
            preview.style.display = 'block';
        }
        
        // Upload products
        async function uploadProducts() {
            if (!db) {
                showStatus('productsStatus', '‚ùå Ch∆∞a k·∫øt n·ªëi Firebase', 'error');
                return;
            }
            
            if (productsData.length === 0) {
                showStatus('productsStatus', '‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ upload', 'error');
                return;
            }
            
            document.getElementById('productsUploadBtn').disabled = true;
            showStatus('productsStatus', 'üöÄ ƒêang upload s·∫£n ph·∫©m l√™n Firebase...', 'info');
            
            try {
                let uploaded = 0;
                let duplicates = 0;
                
                for (const product of productsData) {
                    const existingQuery = await db.collection('products')
                        .where('customer', '==', product.customer)
                        .where('product', '==', product.product)
                        .where('model', '==', product.model)
                        .get();
                    
                    if (existingQuery.empty) {
                        await db.collection('products').add(product);
                        uploaded++;
                    } else {
                        duplicates++;
                    }
                }
                
                showStatus('productsStatus', `‚úÖ Upload th√†nh c√¥ng! ${uploaded} m·ªõi, ${duplicates} tr√πng l·∫∑p`, 'success');
            } catch (error) {
                showStatus('productsStatus', '‚ùå L·ªói upload: ' + error.message, 'error');
            }
            
            document.getElementById('productsUploadBtn').disabled = false;
        }
        
        // Handle users file
        function handleUsersFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            showStatus('usersStatus', 'üìñ ƒêang ƒë·ªçc file...', 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    parseUsersData(jsonData);
                } catch (error) {
                    showStatus('usersStatus', '‚ùå L·ªói ƒë·ªçc file: ' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // Parse users data
        function parseUsersData(rawData) {
            if (!rawData || rawData.length < 2) {
                showStatus('usersStatus', '‚ùå File kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá', 'error');
                return;
            }
            
            const headers = rawData[0].map(h => h?.toString().trim().toLowerCase());
            const msnvIndex = headers.findIndex(h => h.includes('msnv') || h.includes('m√£ s·ªë'));
            const nameIndex = headers.findIndex(h => h.includes('t√™n') || h.includes('h·ªç'));
            const positionIndex = headers.findIndex(h => h.includes('ch·ª©c v·ª•') || h.includes('position'));
            
            if (msnvIndex === -1 || nameIndex === -1 || positionIndex === -1) {
                showStatus('usersStatus', '‚ùå Kh√¥ng t√¨m th·∫•y c·ªôt MSNV, H·ªç V√† T√™n, ho·∫∑c Ch·ª©c v·ª•', 'error');
                return;
            }
            
            usersData = [];
            let validRows = 0;
            
            for (let i = 1; i < rawData.length; i++) {
                const row = rawData[i];
                if (!row || row.length === 0) continue;
                
                const msnv = row[msnvIndex]?.toString().trim();
                const name = row[nameIndex]?.toString().trim();
                const position = row[positionIndex]?.toString().trim();
                
                if (msnv && name && position) {
                    usersData.push({
                        msnv: msnv,
                        name: name,
                        position: position,
                        updatedAt: new Date()
                    });
                    validRows++;
                }
            }
            
            if (validRows === 0) {
                showStatus('usersStatus', '‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá', 'error');
                return;
            }
            
            showStatus('usersStatus', `‚úÖ ƒê·ªçc th√†nh c√¥ng ${validRows} ng∆∞·ªùi l·∫≠p`, 'success');
            displayUsersPreview();
            document.getElementById('usersUploadBtn').disabled = false;
        }
        
        // Display users preview
        function displayUsersPreview() {
            const preview = document.getElementById('usersPreview');
            let html = '<table><tr><th>MSNV</th><th>H·ªç V√† T√™n</th><th>Ch·ª©c v·ª•</th></tr>';
            
            const displayCount = Math.min(usersData.length, 10);
            for (let i = 0; i < displayCount; i++) {
                const user = usersData[i];
                html += `<tr><td>${user.msnv}</td><td>${user.name}</td><td>${user.position}</td></tr>`;
            }
            
            if (usersData.length > 10) {
                html += `<tr><td colspan="3" style="text-align: center; font-style: italic;">... v√† ${usersData.length - 10} ng∆∞·ªùi l·∫≠p kh√°c</td></tr>`;
            }
            
            html += '</table>';
            preview.innerHTML = html;
            preview.style.display = 'block';
        }
        
        // Upload users
        async function uploadUsers() {
            if (!db) {
                showStatus('usersStatus', '‚ùå Ch∆∞a k·∫øt n·ªëi Firebase', 'error');
                return;
            }
            
            if (usersData.length === 0) {
                showStatus('usersStatus', '‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ upload', 'error');
                return;
            }
            
            document.getElementById('usersUploadBtn').disabled = true;
            showStatus('usersStatus', 'üöÄ ƒêang upload ng∆∞·ªùi l·∫≠p l√™n Firebase...', 'info');
            
            try {
                let uploaded = 0;
                let duplicates = 0;
                
                for (const user of usersData) {
                    const existingQuery = await db.collection('users').where('msnv', '==', user.msnv).get();
                    
                    if (existingQuery.empty) {
                        await db.collection('users').add(user);
                        uploaded++;
                    } else {
                        const existingDoc = existingQuery.docs[0];
                        await existingDoc.ref.update(user);
                        duplicates++;
                    }
                }
                
                showStatus('usersStatus', `‚úÖ Upload th√†nh c√¥ng! ${uploaded} m·ªõi, ${duplicates} c·∫≠p nh·∫≠t`, 'success');
            } catch (error) {
                showStatus('usersStatus', '‚ùå L·ªói upload: ' + error.message, 'error');
            }
            
            document.getElementById('usersUploadBtn').disabled = false;
        }
        
        // Add user manually
        function addUser() {
            const msnv = document.getElementById('newUserMsnv').value.trim();
            const name = document.getElementById('newUserName').value.trim();
            const position = document.getElementById('newUserPosition').value.trim();
            
            if (!msnv || !name || !position) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            if (manualUsers.find(u => u.msnv === msnv)) {
                alert('MSNV ƒë√£ t·ªìn t·∫°i!');
                return;
            }
            
            manualUsers.push({
                msnv: msnv,
                name: name,
                position: position,
                updatedAt: new Date()
            });
            
            document.getElementById('newUserMsnv').value = '';
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserPosition').value = '';
            
            updateManualUsersTable();
            document.getElementById('manualUploadBtn').disabled = false;
        }
        
        // Update manual users table
        function updateManualUsersTable() {
            const tbody = document.getElementById('manualUsersTableBody');
            
            if (manualUsers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: #666; font-style: italic;">
                            Ch∆∞a c√≥ ng∆∞·ªùi l·∫≠p n√†o. H√£y th√™m ng∆∞·ªùi l·∫≠p m·ªõi ·ªü tr√™n.
                        </td>
                    </tr>`;
                return;
            }
            
            let html = '';
            manualUsers.forEach((user, index) => {
                html += `
                    <tr>
                        <td>${user.msnv}</td>
                        <td>${user.name}</td>
                        <td>${user.position}</td>
                        <td>
                            <button onclick="removeUser(${index})" style="background: #f44336; padding: 5px 8px; font-size: 12px;">
                                üóëÔ∏è
                            </button>
                        </td>
                    </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Remove user
        function removeUser(index) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi l·∫≠p n√†y?')) {
                manualUsers.splice(index, 1);
                updateManualUsersTable();
                
                if (manualUsers.length === 0) {
                    document.getElementById('manualUploadBtn').disabled = true;
                }
            }
        }
        
        // Upload manual users
        async function uploadManualUsers() {
            if (!db) {
                showStatus('manualStatus', '‚ùå Ch∆∞a k·∫øt n·ªëi Firebase', 'error');
                return;
            }
            
            if (manualUsers.length === 0) {
                showStatus('manualStatus', '‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ upload', 'error');
                return;
            }
            
            document.getElementById('manualUploadBtn').disabled = true;
            showStatus('manualStatus', 'üöÄ ƒêang upload ng∆∞·ªùi l·∫≠p l√™n Firebase...', 'info');
            
            try {
                let uploaded = 0;
                let duplicates = 0;
                
                for (const user of manualUsers) {
                    const existingQuery = await db.collection('users').where('msnv', '==', user.msnv).get();
                    
                    if (existingQuery.empty) {
                        await db.collection('users').add(user);
                        uploaded++;
                    } else {
                        const existingDoc = existingQuery.docs[0];
                        await existingDoc.ref.update(user);
                        duplicates++;
                    }
                }
                
                showStatus('manualStatus', `‚úÖ Upload th√†nh c√¥ng! ${uploaded} m·ªõi, ${duplicates} c·∫≠p nh·∫≠t`, 'success');
                
                manualUsers = [];
                updateManualUsersTable();
                document.getElementById('manualUploadBtn').disabled = true;
                
            } catch (error) {
                showStatus('manualStatus', '‚ùå L·ªói upload: ' + error.message, 'error');
            }
            
            document.getElementById('manualUploadBtn').disabled = false;
        }
        
        // Show status message
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = message ? `status ${type}` : '';
        }
    </script>
</body>
</html>

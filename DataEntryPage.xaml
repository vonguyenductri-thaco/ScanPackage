<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ScanPackage.DataEntryPage"
             BackgroundColor="#F8F3F3">

    <Grid RowDefinitions="Auto,*,Auto" Padding="0">

        <!-- Header Component (Fixed - không scroll) -->
        <Grid Grid.Row="0" 
              x:Name="HeaderGrid"
              BackgroundColor="#F8F3F3"
              MinimumHeightRequest="50">
            <Grid ColumnDefinitions="Auto,*">
                <!-- Back Button -->
                <Border Grid.Column="0"
                        BackgroundColor="Transparent"
                        Padding="4"
                        StrokeThickness="0"
                        VerticalOptions="End"
                        Margin="0,15,23,11">
                    <Image Source="back_icon.svg"
                           WidthRequest="24"
                           HeightRequest="24"
                           Aspect="AspectFit"/>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnBackButtonClicked"/>
                    </Border.GestureRecognizers>
                </Border>

                <!-- Title -->
                <Label Grid.Column="1"
                       Text="Thông tin kiện hàng"
                       FontSize="22"
                       FontAttributes="Bold"
                       TextColor="Black"
                       VerticalOptions="End"
                       HorizontalOptions="Start"
                       Margin="0,0,0,12"/>
            </Grid>
        </Grid>

        <!-- Scrollable Content Area (Giữa) -->
        <ScrollView Grid.Row="1"
                    VerticalOptions="Fill">
            <VerticalStackLayout Spacing="0">

                <!-- White Area Container cho input fields -->
                <Border Margin="10,0,10,0"
                        Padding="10"
                        BackgroundColor="White"
                        Stroke="Transparent"
                        StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Grid RowDefinitions="Auto,Auto" RowSpacing="10">

                        <!-- Row 1: Số thứ tự + Số container -->
                        <Grid Grid.Row="0" ColumnDefinitions="120,20,*" ColumnSpacing="0">
                            <!-- Số thứ tự -->
                            <VerticalStackLayout Grid.Column="0" Spacing="8">
                                <Label Text="Số thứ tự"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"/>
                                <Border Stroke="#BFBFBF"
                                        StrokeThickness="1"
                                        Padding="0"
                                        BackgroundColor="White"
                                        HeightRequest="42">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <Entry x:Name="SttEntry"
                                           Keyboard="Numeric"
                                           Placeholder=""
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                           FontSize="14"
                                           Margin="12,0"/>
                                </Border>
                            </VerticalStackLayout>

                            <!-- Số container (camera icon ẩn) -->
                            <VerticalStackLayout Grid.Column="2" Spacing="8">
                                <Label Text="Số container"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"/>
                                <Border Stroke="#BFBFBF"
                                        StrokeThickness="1"
                                        Padding="0"
                                        BackgroundColor="White"
                                        HeightRequest="42">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <Entry x:Name="ContainerEntry"
                                           Placeholder=""
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                           FontSize="14"
                                           Margin="12,0"/>
                                </Border>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Row 2: Ngày + Số seal -->
                        <Grid Grid.Row="1" ColumnDefinitions="120,20,*" ColumnSpacing="0">
                            <!-- Ngày -->
                            <VerticalStackLayout Grid.Column="0" Spacing="8">
                                <Label Text="Ngày"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"/>
                                <Border Stroke="#BFBFBF"
                                        StrokeThickness="1"
                                        Padding="0"
                                        BackgroundColor="White"
                                        HeightRequest="42">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <DatePicker x:Name="DateEntry"
                                                Format="dd/MM/yyyy"
                                                BackgroundColor="Transparent"
                                                TextColor="Black"
                                                FontSize="14"
                                                Margin="8,0"/>
                                </Border>
                            </VerticalStackLayout>

                            <!-- Số seal (camera icon ẩn) -->
                            <VerticalStackLayout Grid.Column="2" Spacing="8">
                                <Label Text="Số seal"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"/>
                                <Border Stroke="#BFBFBF"
                                        StrokeThickness="1"
                                        Padding="0"
                                        BackgroundColor="White"
                                        HeightRequest="42">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <Entry x:Name="SealEntry"
                                           Placeholder=""
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                           FontSize="14"
                                           Margin="12,0"/>
                                </Border>
                            </VerticalStackLayout>
                        </Grid>

                    </Grid>
                </Border>

                <!-- White Area Container cho thông tin sản phẩm -->
                <Border Margin="10,10,10,0"
                        Padding="10"
                        BackgroundColor="White"
                        Stroke="Transparent"
                        StrokeThickness="0"
                        HeightRequest="190">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Grid RowDefinitions="Auto,Auto" RowSpacing="10">

                        <!-- Row 1: Tên khách hàng + Tên sản phẩm -->
                        <Grid Grid.Row="0" ColumnDefinitions="*,15,*" ColumnSpacing="0">
                            <!-- Tên khách hàng -->
                            <VerticalStackLayout Grid.Column="0" Spacing="8">
                                <Label Text="Tên khách hàng"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"/>
                                <Border Stroke="#BFBFBF"
                                       StrokeThickness="1"
                                       Padding="0"
                                       BackgroundColor="White"
                                       HeightRequest="42">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0"
                                               x:Name="CustomerLabel"
                                               TextColor="#9E9E9E"
                                               FontSize="14"
                                               VerticalOptions="Center"
                                               Margin="12,0"/>
                                        <Image Grid.Column="1"
                                               Source="dropdown_icon.svg"
                                               WidthRequest="20"
                                               HeightRequest="20"
                                               Margin="0,0,10,0"
                                               VerticalOptions="Center"/>
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnCustomerPickerTapped"/>
                                        </Grid.GestureRecognizers>
                                    </Grid>
                                </Border>
                            </VerticalStackLayout>

                            <!-- Tên sản phẩm -->
                            <VerticalStackLayout Grid.Column="2" Spacing="8">
                                <Label Text="Tên sản phẩm"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"/>
                                <Border Stroke="#BFBFBF"
                                       StrokeThickness="1"
                                       Padding="0"
                                       BackgroundColor="White"
                                       HeightRequest="42">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0"
                                               x:Name="ProductLabel"
                                               TextColor="#9E9E9E"
                                               FontSize="14"
                                               VerticalOptions="Center"
                                               Margin="12,0"/>
                                        <Image Grid.Column="1"
                                               Source="dropdown_icon.svg"
                                               WidthRequest="20"
                                               HeightRequest="20"
                                               Margin="0,0,10,0"
                                               VerticalOptions="Center"/>
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnProductPickerTapped"/>
                                        </Grid.GestureRecognizers>
                                    </Grid>
                                </Border>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Row 2: Model + Người lập -->
                        <Grid Grid.Row="1" ColumnDefinitions="*,15,*" ColumnSpacing="0">
                            <!-- Model -->
                            <VerticalStackLayout Grid.Column="0" Spacing="8">
                                <Label Text="Tên Model"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"/>
                                <Border Stroke="#BFBFBF"
                                       StrokeThickness="1"
                                       Padding="0"
                                       BackgroundColor="White"
                                       HeightRequest="42">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0"
                                               x:Name="ModelLabel"
                                               TextColor="#9E9E9E"
                                               FontSize="14"
                                               VerticalOptions="Center"
                                               Margin="12,0"/>
                                        <Image Grid.Column="1"
                                               Source="dropdown_icon.svg"
                                               WidthRequest="20"
                                               HeightRequest="20"
                                               Margin="0,0,10,0"
                                               VerticalOptions="Center"/>
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnModelPickerTapped"/>
                                        </Grid.GestureRecognizers>
                                    </Grid>
                                </Border>
                            </VerticalStackLayout>

                            <!-- Người lập -->
                            <VerticalStackLayout Grid.Column="2" Spacing="8">
                                <Label Text="Người lập"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"/>
                                <Border Stroke="#BFBFBF"
                                       StrokeThickness="1"
                                       Padding="0"
                                       BackgroundColor="White"
                                       HeightRequest="42">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0"
                                               x:Name="CreatorLabel"
                                               Text="Chọn người lập"
                                               TextColor="#9E9E9E"
                                               FontSize="14"
                                               VerticalOptions="Center"
                                               Margin="12,0"/>
                                        <Image Grid.Column="1"
                                               Source="dropdown_icon.svg"
                                               WidthRequest="20"
                                               HeightRequest="20"
                                               Margin="0,0,10,0"
                                               VerticalOptions="Center"/>
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnCreatorPickerTapped"/>
                                        </Grid.GestureRecognizers>
                                    </Grid>
                                </Border>
                            </VerticalStackLayout>
                        </Grid>

                    </Grid>
                </Border>

                <!-- Ảnh chụp (3 mục) -->
                <Border Margin="10,10,10,0"
                        Padding="12"
                        BackgroundColor="White"
                        Stroke="Transparent"
                        StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="12">
                        <Label Grid.Row="0"
                               Text="Hình ảnh"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="Black"/>

                        <!-- 4 ảnh trên 1 hàng với tỷ lệ 9:16 -->
                        <Grid Grid.Row="1" ColumnDefinitions="*,5,*,5,*,5,*" RowSpacing="8">
                            <!-- Ảnh 1 -->
                            <Border Grid.Column="0"
                                    BackgroundColor="#F5F5F5"
                                    Stroke="#E0E0E0"
                                    StrokeThickness="1"
                                    HeightRequest="160"
                                    MinimumHeightRequest="160">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8"/>
                                </Border.StrokeShape>
                                <Grid>
                                    <Image x:Name="Photo1Image"
                                           Aspect="AspectFill"
                                           HorizontalOptions="Fill"
                                           VerticalOptions="Fill"/>
                                    <VerticalStackLayout x:Name="Photo1Placeholder"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center"
                                                       Spacing="4">
                                        <Image Source="camera_placeholder.png"
                                               WidthRequest="20"
                                               HeightRequest="20"/>
                                        <Label Text="Chụp ảnh"
                                               FontSize="8"
                                               TextColor="#9E9E9E"/>
                                    </VerticalStackLayout>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnPhoto1Tapped"/>
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Ảnh 2 -->
                            <Border Grid.Column="2"
                                    BackgroundColor="#F5F5F5"
                                    Stroke="#E0E0E0"
                                    StrokeThickness="1"
                                    HeightRequest="160"
                                    MinimumHeightRequest="160">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8"/>
                                </Border.StrokeShape>
                                <Grid>
                                    <Image x:Name="Photo2Image"
                                           Aspect="AspectFill"
                                           HorizontalOptions="Fill"
                                           VerticalOptions="Fill"/>
                                    <VerticalStackLayout x:Name="Photo2Placeholder"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center"
                                                       Spacing="4">
                                        <Image Source="camera_placeholder.png"
                                               WidthRequest="20"
                                               HeightRequest="20"/>
                                        <Label Text="Chụp ảnh"
                                               FontSize="8"
                                               TextColor="#9E9E9E"/>
                                    </VerticalStackLayout>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnPhoto2Tapped"/>
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Ảnh 3 -->
                            <Border Grid.Column="4"
                                    BackgroundColor="#F5F5F5"
                                    Stroke="#E0E0E0"
                                    StrokeThickness="1"
                                    HeightRequest="160"
                                    MinimumHeightRequest="160">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8"/>
                                </Border.StrokeShape>
                                <Grid>
                                    <Image x:Name="Photo3Image"
                                           Aspect="AspectFill"
                                           HorizontalOptions="Fill"
                                           VerticalOptions="Fill"/>
                                    <VerticalStackLayout x:Name="Photo3Placeholder"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center"
                                                       Spacing="4">
                                        <Image Source="camera_placeholder.png"
                                               WidthRequest="20"
                                               HeightRequest="20"/>
                                        <Label Text="Chụp ảnh"
                                               FontSize="8"
                                               TextColor="#9E9E9E"/>
                                    </VerticalStackLayout>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnPhoto3Tapped"/>
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Ảnh 4 -->
                            <Border Grid.Column="6"
                                    BackgroundColor="#F5F5F5"
                                    Stroke="#E0E0E0"
                                    StrokeThickness="1"
                                    HeightRequest="160"
                                    MinimumHeightRequest="160">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8"/>
                                </Border.StrokeShape>
                                <Grid>
                                    <Image x:Name="Photo4Image"
                                           Aspect="AspectFill"
                                           HorizontalOptions="Fill"
                                           VerticalOptions="Fill"/>
                                    <VerticalStackLayout x:Name="Photo4Placeholder"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center"
                                                       Spacing="4">
                                        <Image Source="camera_placeholder.png"
                                               WidthRequest="20"
                                               HeightRequest="20"/>
                                        <Label Text="Chụp ảnh"
                                               FontSize="8"
                                               TextColor="#9E9E9E"/>
                                    </VerticalStackLayout>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnPhoto4Tapped"/>
                                </Border.GestureRecognizers>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Bảng dữ liệu -->
                <Border x:Name="TableContainerFrame"
                       Margin="10,10,10,10"
                       Padding="10"
                       BackgroundColor="White"
                       Stroke="Transparent"
                       StrokeThickness="0"
                       VerticalOptions="Start">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Grid RowDefinitions="Auto,*" VerticalOptions="Start">
                        <Label Grid.Row="0"
                               Text="Bảng dữ liệu"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="Black"
                               Margin="0,0,0,8"/>

                        <!-- Frozen Headers Grid Structure -->
                        <Grid Grid.Row="1" VerticalOptions="Fill">
                            <!-- Main scrollable data grid -->
                            <ScrollView x:Name="MainScrollView"
                                        Orientation="Both"
                                        HorizontalScrollBarVisibility="Always"
                                        VerticalScrollBarVisibility="Always"
                                        Scrolled="OnScrollViewScrolled">
                                <Grid x:Name="DataGrid"
                                      ColumnSpacing="1"
                                      RowSpacing="1"
                                      Padding="0"
                                      BackgroundColor="#E0E0E0"/>
                            </ScrollView>

                            <!-- Frozen Column Header (Top) -->
                            <Grid x:Name="FrozenColumnHeader"
                                  InputTransparent="True"
                                  VerticalOptions="Start"
                                  MinimumHeightRequest="32"
                                  BackgroundColor="#E0E0E0"
                                  ColumnSpacing="1"
                                  Margin="32,0,0,0"/>

                            <!-- Frozen Row Header (Left) -->
                            <Grid x:Name="FrozenRowHeader"
                                  InputTransparent="True"
                                  HorizontalOptions="Start"
                                  MinimumWidthRequest="32"
                                  BackgroundColor="#E0E0E0"
                                  RowSpacing="1"
                                  Margin="0,32,0,0"/>

                            <!-- Top-left corner cell -->
                            <BoxView Color="#F5F5F5"
                                     HorizontalOptions="Start"
                                     VerticalOptions="Start"
                                     MinimumWidthRequest="32"
                                     MinimumHeightRequest="32"/>
                        </Grid>
                    </Grid>
                </Border>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Footer with Export Button (Fixed - không scroll) -->
        <Grid Grid.Row="2" 
              x:Name="FooterGrid"
              BackgroundColor="White"
              Padding="10,20,10,20"
              MinimumHeightRequest="100">

            <!-- Button Gradient (Đỏ - Cam) -->
            <Border StrokeThickness="0"
                    MinimumHeightRequest="60"
                    HorizontalOptions="Fill"
                    VerticalOptions="Center">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="30"/>
                </Border.StrokeShape>
                <Border.Background>
                    <LinearGradientBrush StartPoint="1,0.5" EndPoint="0,0.5">
                        <GradientStop Color="#ED1C24" Offset="0.0" />
                        <GradientStop Color="#F7941D" Offset="1.0" />
                    </LinearGradientBrush>
                </Border.Background>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnExportClicked"/>
                </Border.GestureRecognizers>

                <Label Text="Hoàn thành &amp; Xuất Excel"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       InputTransparent="True"/>
            </Border>
        </Grid>

    </Grid>
</ContentPage>
